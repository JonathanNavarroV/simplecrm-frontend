<label *ngIf="label" class="text-xs text-gray-600 mb-1 block">{{ label }}</label>

<div class="w-full">
  <ng-container *ngIf="!multiple; else multiTpl">
    <div class="relative" [appCloseOnInteract]="isOpen" (requestClose)="close()">
      <button
        type="button"
        class="w-full rounded border px-3 py-2 pr-8 text-sm border-gray-300 focus:outline-none focus-visible:ring-1 focus-visible:ring-indigo-200 focus:border-indigo-500 appearance-none text-left flex items-center"
        [disabled]="disabled"
        [class.bg-gray-200]="disabled"
        [class.text-gray-400]="disabled"
        [class.border-red-500]="!!error"
        (click)="toggleOpen()"
        [attr.aria-expanded]="isOpen"
        [attr.aria-disabled]="disabled"
        [attr.aria-invalid]="!!error"
      >
        <span
          class="truncate"
          [class.text-gray-400]="!selectedLabels"
          [class.text-gray-700]="!!selectedLabels"
        >
          {{ selectedLabels || placeholder || '\u00A0' }}
        </span>
      </button>

      <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center">
        <app-icon name="chevron-down" class="h-4 w-4 text-gray-500"></app-icon>
      </div>

      <div
        *ngIf="isOpen"
        class="absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-60 overflow-auto"
      >
        <ul class="divide-y">
          <li *ngFor="let o of normalizedOptions">
            <label
              class="flex items-center w-full px-3 py-2 hover:bg-gray-300 cursor-pointer"
              role="option"
              [attr.tabindex]="disabled ? -1 : 0"
              (click)="disabled ? null : toggleOption(o.value)"
              (keydown.enter)="disabled ? null : toggleOption(o.value)"
              (keydown.space)="$event.preventDefault(); disabled ? null : toggleOption(o.value)"
              [class.pointer-events-none]="disabled"
              [attr.aria-disabled]="disabled"
            >
              <span class="flex-1">{{ o.label }}</span>
              <span *ngIf="isSelected(o.value)" class="text-indigo-600">âœ“</span>
            </label>
          </li>
        </ul>
      </div>
    </div>

    <div *ngIf="error" class="text-xs text-red-600 mt-1">{{ error }}</div>
  </ng-container>

  <ng-template #multiTpl>
    <div class="relative" [appCloseOnInteract]="isOpen" (requestClose)="close()">
      <button
        type="button"
        class="w-full rounded border px-3 py-2 pr-8 text-sm border-gray-300 focus:outline-none focus-visible:ring-1 focus-visible:ring-indigo-200 focus:border-indigo-500 appearance-none text-left flex items-center"
        [disabled]="disabled"
        [class.bg-gray-200]="disabled"
        [class.text-gray-400]="disabled"
        [class.border-red-500]="!!error"
        (click)="toggleOpen()"
        [attr.aria-expanded]="isOpen"
        [attr.aria-disabled]="disabled"
        [attr.aria-invalid]="!!error"
      >
        <span
          class="truncate"
          [class.text-gray-400]="!selectedLabels"
          [class.text-gray-700]="!!selectedLabels"
        >
          {{ selectedLabels || placeholder || '\u00A0' }}
        </span>
      </button>

      <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center">
        <app-icon name="chevron-down" class="h-4 w-4 text-gray-500"></app-icon>
      </div>

      <div
        *ngIf="isOpen"
        class="absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-60 overflow-auto"
      >
        <ul class="divide-y">
          <li *ngFor="let o of normalizedOptions">
            <label
              class="flex items-center px-3 py-2 hover:bg-gray-300 cursor-pointer"
              [attr.aria-disabled]="disabled"
            >
              <input
                type="checkbox"
                class="mr-3"
                [checked]="isSelected(o.value)"
                (change)="toggleOption(o.value)"
                [disabled]="disabled"
              />
              <span class="flex-1">{{ o.label }}</span>
            </label>
          </li>
        </ul>
      </div>
    </div>

    <div *ngIf="error" class="text-xs text-red-600 mt-1">{{ error }}</div>
  </ng-template>
</div>
