<label *ngIf="label" class="text-xs text-gray-600 mb-1 block">{{ label }}</label>

<div *ngIf="!isSkeleton" class="relative w-full">
  <div
    class="relative w-full rounded border border-gray-300 focus-within:ring-1 focus-within:ring-indigo-200 focus-within:border-indigo-500"
    [class.bg-gray-200]="disabled || isLoading"
    [class.ring-1]="open"
    [class.ring-indigo-200]="open"
    [class.border-indigo-500]="open"
    [appCloseOnInteract]="open"
    (requestClose)="open = false"
  >
    <input
      #inputRef
      type="text"
      readonly
      class="w-full px-3 py-2 text-sm bg-transparent placeholder-gray-400 focus:outline-none cursor-default select-none"
      (mousedown)="$event.preventDefault()"
      [class.text-gray-400]="disabled || isLoading"
      [class.pr-10]="isLoading"
      [placeholder]="placeholder"
      [value]="isLoading ? 'Cargando...' : value || ''"
      [disabled]="disabled || isLoading"
      (input)="onInput($event)"
      (keydown)="onKeydown($event)"
      (click)="onInputClick($event)"
      (blur)="onTouched()"
      [attr.aria-busy]="isLoading"
    />

    <div class="absolute inset-y-0 right-2 flex items-center space-x-2">
      <button
        *ngIf="clearable && value && !disabled && !isLoading"
        type="button"
        class="inline-flex items-center justify-center rounded-full p-1 hover:bg-gray-100 cursor-pointer"
        (click)="clear()"
        aria-label="Limpiar fecha"
      >
        <app-icon name="close" iconClass="h-4 w-4 text-gray-500"></app-icon>
      </button>

      <div
        class="flex items-center justify-center"
        (click)="!isLoading && toggleOpen()"
        role="button"
        [attr.aria-hidden]="isLoading ? 'true' : 'false'"
      >
        <ng-container *ngIf="!isLoading; else spinnerTpl">
          <app-icon name="calendar-month" iconClass="h-4 w-4 text-gray-500"></app-icon>
        </ng-container>
        <ng-template #spinnerTpl>
          <span
            class="inline-block w-4 h-4 border-2 border-t-transparent border-gray-500 rounded-full animate-spin bg-transparent"
            aria-hidden="true"
          ></span>
        </ng-template>
      </div>
    </div>

    <div #pickerRef *ngIf="open" class="absolute z-50 mt-2" [ngStyle]="pickerStyles">
      <app-date-picker [selected]="_dateValue" (select)="onDateSelected($event)"></app-date-picker>
    </div>
  </div>
</div>

<div *ngIf="isSkeleton" class="relative w-full animate-pulse">
  <div
    class="px-3 py-2 h-9.5 rounded border border-gray-300 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_100%] animate-shimmer"
  ></div>
</div>
