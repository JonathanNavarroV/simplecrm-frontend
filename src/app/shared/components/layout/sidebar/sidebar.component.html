<!-- Spacer: mantiene el espacio del slim sidebar cuando abrimos el overlay
  para que el body no cambie de tamaÃ±o (solo necesario si el collapsed
  mode del breakpoint es `slim`). -->
<div
  *ngIf="currentMode === 'overlay' && collapsedModeForCurrentBreakpoint === 'slim'"
  class="w-16 h-full flex-shrink-0"
></div>

<aside
  *ngIf="currentMode !== 'hidden'"
  [class.w-16]="currentMode === 'slim'"
  [class.w-72]="currentMode === 'expanded' || currentMode === 'overlay'"
  [class.fixed]="currentMode === 'overlay'"
  [class.top-0]="currentMode === 'overlay'"
  [class.left-0]="currentMode === 'overlay'"
  [class.h-screen]="currentMode === 'overlay'"
  [class.h-full]="currentMode !== 'overlay'"
  [class.inset-y-0]="currentMode === 'overlay'"
  class="flex shrink-0 border-r border-gray-200"
  [ngClass]="{
    'bg-white': currentMode === 'overlay',
    'bg-white/80 backdrop-blur-md': currentMode !== 'overlay',
  }"
  [class.z-50]="currentMode !== 'overlay'"
  [class.z-60]="currentMode === 'overlay'"
>
  <div class="flex h-full w-full flex-col">
    <!-- Header dentro del aside cuando estamos en modo overlay -->
    <div
      *ngIf="currentMode === 'overlay'"
      class="h-16 w-full border-b border-gray-200 bg-white flex items-center px-4"
    >
      <div class="flex items-center gap-3">
        <div class="h-8 w-8 rounded-md bg-indigo-400"></div>
        <div class="font-semibold tracking-tight">SimpleCRM</div>
      </div>
    </div>
    <!-- Nav -->
    <nav class="flex-1 overflow-y-auto py-4">
      <ul class="px-3 space-y-1">
        <li *ngFor="let module of sidebarItems; let si = index">
          <!-- separator visible only on slim and not for the first module -->
          <div *ngIf="si > 0 && currentMode === 'slim'" class="h-px bg-gray-200 my-2 w-full"></div>

          <!-- module label (hidden in slim) -->
          <div
            *ngIf="currentMode !== 'slim'"
            class="px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide"
          >
            {{ module.label }}
          </div>

          <ul class="pl-0">
            <li *ngFor="let item of module.items; let i = index">
              <a
                [routerLink]="item.route"
                routerLinkActive="bg-gray-200 text-gray-900"
                [routerLinkActiveOptions]="{ exact: true }"
                class="flex items-center rounded-md text-gray-700 hover:bg-gray-200 hover:text-gray-900 px-3 py-2"
                [class.gap-0]="currentMode === 'slim'"
                [class.gap-3]="currentMode !== 'slim'"
                [class.justify-center]="currentMode === 'slim'"
                [class.justify-start]="currentMode !== 'slim'"
                (click)="onNavItemClick()"
              >
                <app-icon [name]="item.icon" [class]="'size-6'" />
                <span *ngIf="currentMode !== 'slim'" class="ml-3">{{ item.label }}</span>
                <span *ngIf="currentMode === 'slim'" class="sr-only">{{ item.label }}</span>
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </nav>

    <!-- Usuario -->
    <!-- Full footer (visible when not slim) -->
    <div *ngIf="currentMode !== 'slim'" class="border-t border-gray-200/70 px-4 py-3">
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3 min-w-0">
          <div class="h-9 w-9 rounded-full bg-indigo-200"></div>
          <div class="min-w-0">
            <div class="text-sm font-medium text-gray-900">Jonathan Navarro</div>
            <div class="text-xs text-gray-500">Ejecutivo</div>
          </div>
        </div>

        <div class="flex items-center">
          <button
            type="button"
            (click)="toggleSidebar()"
            class="inline-flex items-center justify-center h-8 w-8 rounded-md text-gray-500 hover:bg-gray-200 cursor-pointer"
            aria-label="Mostrar/Ocultar sidebar"
          >
            <app-icon name="chevron-double-left" class="size-5"></app-icon>
          </button>
        </div>
      </div>
    </div>
    <!-- Slim footer: avatar on top, button below -->
    <div
      *ngIf="currentMode === 'slim'"
      class="flex flex-col items-center gap-2 border-t border-gray-200/70 px-2 py-3"
    >
      <div class="h-9 w-9 rounded-full bg-indigo-200"></div>
      <button
        type="button"
        (click)="toggleSidebar()"
        class="inline-flex items-center justify-center h-8 w-8 rounded-md text-gray-500 hover:bg-gray-200 cursor-pointer"
        aria-label="Ocultar sidebar"
      >
        <app-icon name="chevron-double-right" class="size-5"></app-icon>
      </button>
    </div>
  </div>
</aside>

<!-- Overlay que cubre la app cuando el modo es overlay; al clic se cierra -->
<div
  *ngIf="currentMode === 'overlay'"
  (click)="closeOverlay()"
  class="fixed inset-0 bg-black/40"
  [class.z-50]="true"
></div>
